<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1" />
  <title>极速收货（前台）</title>
  <style>
    :root {
      --primary: #2563eb;
      --bg: #f1f5f9;
      --card: #ffffff;
      --border: #e2e8f0;
      --text: #0f172a;
      --muted: #64748b;
      --accent: #22c55e;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: "PingFang SC", "Inter", -apple-system, BlinkMacSystemFont, "Helvetica Neue", Arial, sans-serif;
      background: var(--bg);
      color: var(--text);
      padding: 12px;
    }
    h1 { margin: 0 0 10px; font-size: 20px; }
    .card {
      background: var(--card);
      border-radius: 14px;
      border: 1px solid var(--border);
      padding: 14px;
      margin-bottom: 12px;
      box-shadow: 0 6px 18px rgba(0,0,0,0.04);
    }
    .batch-buttons { display: flex; gap: 10px; flex-wrap: wrap; }
    .batch-btn {
      padding: 12px 14px;
      border-radius: 12px;
      border: 1px solid var(--border);
      background: #f8fafc;
      cursor: pointer;
      font-weight: 700;
      font-size: 14px;
      min-width: 130px;
    }
    .batch-btn.active { background: var(--primary); color: #fff; border-color: var(--primary); }
    .info-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap: 10px; }
    .info-item { background: #f8fafc; border-radius: 10px; padding: 10px; border: 1px dashed var(--border); }
    .label { color: var(--muted); font-size: 13px; }
    .value { font-weight: 700; margin-top: 4px; }
    input[type="text"], input[type="number"] {
      width: 100%;
      padding: 12px;
      border-radius: 12px;
      border: 1px solid var(--border);
      font-size: 16px;
    }
    input:focus { outline: 2px solid rgba(37,99,235,0.25); }
    .candidate-list { margin-top: 10px; border: 1px solid var(--border); border-radius: 12px; overflow: hidden; }
    .candidate {
      padding: 10px 12px;
      display: flex;
      justify-content: space-between;
      gap: 10px;
      background: #fff;
      cursor: pointer;
    }
    .candidate + .candidate { border-top: 1px solid var(--border); }
    .candidate:hover { background: #eff6ff; }
    .unit-row { display: flex; gap: 8px; flex-wrap: wrap; margin-top: 10px; }
    .unit-btn {
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px solid var(--border);
      background: #fff;
      font-weight: 700;
      min-width: 72px;
      text-align: center;
      cursor: pointer;
    }
    .unit-btn.active { background: var(--primary); color: #fff; border-color: var(--primary); }
    .primary-btn {
      width: 100%;
      padding: 14px;
      font-size: 18px;
      border-radius: 14px;
      border: none;
      background: linear-gradient(120deg, #2563eb, #0ea5e9);
      color: #fff;
      font-weight: 800;
      box-shadow: 0 14px 26px rgba(37,99,235,0.22);
      cursor: pointer;
      margin-top: 12px;
    }
    .records { margin-top: 8px; }
    .record-row {
      display: grid;
      grid-template-columns: 1fr auto auto;
      gap: 8px;
      align-items: center;
      padding: 10px 0;
      border-bottom: 1px solid var(--border);
    }
    .time { color: var(--muted); font-size: 12px; }
    .tag { background: #ecfeff; color: #0ea5e9; padding: 4px 8px; border-radius: 10px; font-weight: 700; font-size: 12px; }
    .group-card { background: #f8fafc; padding: 10px; border-radius: 10px; border: 1px solid var(--border); margin-top: 10px; }
    @media (max-width: 640px) {
      body { padding: 10px; }
      .record-row { grid-template-columns: 1fr; }
      .primary-btn { font-size: 16px; }
    }
  </style>
</head>
<body>
  <h1>单页面极速收货</h1>

  <div class="card">
    <div class="label">选择批次</div>
    <div class="batch-buttons" id="batch-buttons"></div>
  </div>

  <div class="card" id="batch-info">
    <div class="label">当前批次</div>
    <div class="info-grid" id="batch-info-grid"></div>
  </div>

  <div class="card">
    <div class="label">物料搜索</div>
    <input id="material-input" type="text" placeholder="输入物料名称或编码" autocomplete="off" />
    <div class="candidate-list" id="candidate-list"></div>

    <div style="margin-top: 12px;" class="label">数量 + 单位</div>
    <input id="qty-input" type="number" inputmode="decimal" placeholder="输入数量" />
    <div class="unit-row" id="unit-row"></div>
    <button class="primary-btn" id="btn-add">记录本次收货</button>
  </div>

  <div class="card">
    <div class="label">本批次记录</div>
    <div class="records" id="records"></div>
    <div class="group-card" id="summary"></div>
  </div>

  <script>
    const batches = [
      { id: 'IN-2025-11-23-001', date: '2025-11-23', location: '广州·珠江新城', remark: '晚班收货，含冷链' },
      { id: 'IN-2025-11-24-001', date: '2025-11-24', location: '广州·万胜围', remark: '供应商 A 送货' },
      { id: 'IN-2025-11-25-001', date: '2025-11-25', location: '佛山·南海中心', remark: '含部分退货' },
    ];

    const materials = [
      { name: '糖浆 A 1L', brand: '品牌 A', unitRule: '10 瓶/箱', tags: ['糖浆', '精计'] },
      { name: '糖浆 B 1L', brand: '品牌 B', unitRule: '15 瓶/箱', tags: ['糖浆', '精计'] },
      { name: '糖浆', brand: '通用', unitRule: '无包装', tags: ['糖浆'] },
      { name: '包装袋 A', brand: '品牌 C', unitRule: '粗计', tags: ['包装'] },
    ];

    const units = ['瓶', '箱', '包', '件'];

    const batchButtons = document.getElementById('batch-buttons');
    const batchInfoGrid = document.getElementById('batch-info-grid');
    const candidateList = document.getElementById('candidate-list');
    const materialInput = document.getElementById('material-input');
    const qtyInput = document.getElementById('qty-input');
    const unitRow = document.getElementById('unit-row');
    const recordsEl = document.getElementById('records');
    const summaryEl = document.getElementById('summary');

    let currentBatch = batches[0];
    let selectedUnit = units[0];
    const records = [];

    const renderBatches = () => {
      batchButtons.innerHTML = '';
      batches.forEach((b) => {
        const btn = document.createElement('button');
        btn.className = 'batch-btn' + (b.id === currentBatch.id ? ' active' : '');
        btn.textContent = b.id;
        btn.onclick = () => {
          currentBatch = b;
          renderBatches();
          renderBatchInfo();
        };
        batchButtons.appendChild(btn);
      });
    };

    const renderBatchInfo = () => {
      batchInfoGrid.innerHTML = '';
      const infoItems = [
        { label: '批次编号', value: currentBatch.id },
        { label: '收货日期', value: currentBatch.date },
        { label: '地点', value: currentBatch.location },
        { label: '备注', value: currentBatch.remark },
      ];
      infoItems.forEach((item) => {
        const div = document.createElement('div');
        div.className = 'info-item';
        div.innerHTML = `<div class="label">${item.label}</div><div class="value">${item.value}</div>`;
        batchInfoGrid.appendChild(div);
      });
    };

    const renderUnits = () => {
      unitRow.innerHTML = '';
      units.forEach((u) => {
        const btn = document.createElement('div');
        btn.className = 'unit-btn' + (u === selectedUnit ? ' active' : '');
        btn.textContent = u;
        btn.onclick = () => {
          selectedUnit = u;
          renderUnits();
        };
        unitRow.appendChild(btn);
      });
    };

    const renderCandidates = (keyword = '') => {
      const lower = keyword.trim().toLowerCase();
      const results = materials.filter((m) => m.name.toLowerCase().includes(lower) || m.brand.toLowerCase().includes(lower));
      candidateList.innerHTML = '';
      results.forEach((m) => {
        const row = document.createElement('div');
        row.className = 'candidate';
        row.innerHTML = `<div><div>${m.name}</div><div class="label">${m.brand}｜${m.unitRule}</div></div><div class="tag">${m.tags[0] || '物料'}</div>`;
        row.onclick = () => {
          materialInput.value = m.name;
          materialInput.focus();
        };
        candidateList.appendChild(row);
      });
    };

    const renderRecords = () => {
      recordsEl.innerHTML = '';
      records.forEach((r) => {
        const row = document.createElement('div');
        row.className = 'record-row';
        row.innerHTML = `
          <div>
            <div>${r.material}</div>
            <div class="time">${r.time}</div>
          </div>
          <div class="value">${r.qty}</div>
          <div class="tag">${r.unit}</div>
        `;
        recordsEl.appendChild(row);
      });
      renderSummary();
    };

    const renderSummary = () => {
      const grouped = records.reduce((acc, cur) => {
        const key = `${cur.material}-${cur.unit}`;
        acc[key] = (acc[key] || 0) + Number(cur.qty || 0);
        return acc;
      }, {});
      const entries = Object.entries(grouped);
      if (!entries.length) {
        summaryEl.innerHTML = '<span class="label">暂无汇总</span>';
        return;
      }
      summaryEl.innerHTML = entries.map(([k, v]) => {
        const [mat, unit] = k.split('-');
        return `<div><strong>${mat}</strong>：${v} ${unit}</div>`;
      }).join('');
    };

    document.getElementById('btn-add').onclick = () => {
      const material = materialInput.value.trim();
      const qty = qtyInput.value.trim();
      if (!material || !qty) {
        alert('请先选择物料并输入数量');
        return;
      }
      const time = new Date().toLocaleTimeString('zh-CN', { hour12: false });
      records.unshift({ material, qty, unit: selectedUnit, time });
      materialInput.value = '';
      qtyInput.value = '';
      materialInput.focus();
      renderRecords();
    };

    materialInput.addEventListener('input', (e) => renderCandidates(e.target.value));

    renderBatches();
    renderBatchInfo();
    renderUnits();
    renderCandidates();
    renderRecords();
    materialInput.focus();
  </script>
</body>
</html>
