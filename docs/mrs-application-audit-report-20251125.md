# MRS 物料收发管理系统应用层审计报告

**报告日期**: 2025-11-25
**审计员**: Jules (AI Assistant)
**版本**: v1.0

## 1. 审计目标与范围
本次审计的目标是识别 MRS 系统在**应用操作层面**的潜在问题，例如功能失效、数据流中断、UI 无响应或崩溃等。审计范围重点关注前端用户交互 (`backend.js`) 到后端 API (`app/mrs/api/`) 的完整链路，模拟核心业务流程。

## 2. 总体评估
系统的大部分核心功能流程，包括批次管理、SKU 管理、出库单的创建、保存和确认，都表现出良好的稳定性和逻辑正确性。前后端的数据契约清晰，后端 API 对异常情况（如并发、非法状态变更）有较好的防护。

然而，本次审计在入库流程的**关键闭环步骤——合并确认**中，发现了一个高优先级的应用层 Bug，该 Bug 导致了核心功能的完全中断。

## 3. 核心发现：应用层问题详解

### 3.1 高优先级：入库合并确认功能完全失效

*   **问题描述**: 在“合并确认”页面 (`page-merge`)，用户对收货数据进行调整后，点击“确认”（单项）或“全部确认”按钮时，**页面没有任何反应**。浏览器控制台会抛出 JavaScript 运行时错误。
*   **根本原因**:
    1.  `backend.js` 中的 `showMergePage` 函数在通过 `api.getMergeData` 获取到合并数据后，没有将返回的 `items` 数组存入全局状态 `appState.mergeItems`。
    2.  `confirmItem` 和 `confirmAllMerge` 这两个函数在执行时，都试图从 `appState.mergeItems` 读取数据。
    3.  由于 `appState.mergeItems` 此时为 `undefined`，导致 JavaScript 引擎在尝试访问 `.find()` 或 `.forEach()` 方法时抛出 `TypeError`，中断了后续所有逻辑，包括向后端发送 API 请求。
*   **用户影响**: 此 Bug **完全阻断**了入库流程。用户无法将清点后的数据正式确认入库，导致库存无法增加，使得整个系统的核心价值链（入库 -> 库存 -> 出库）中断。
*   **涉及文件**:
    *   `dc_html/mrs/js/backend.js` (前端逻辑缺陷)

### 3.2 中优先级：UI 功能缺失导致操作中断

*   **问题描述**: 在“合并确认”页面 (`page-merge`) 的表格中，每一行都有一个“查看明细”按钮。点击该按钮后，系统仅弹出一个提示：“查看原始记录功能开发中...”。
*   **根本原因**: `backend.js` 中的 `viewRawRecords` 函数是一个空实现。
*   **用户影响**: 用户无法追溯系统建议的合并数量是由哪些原始记录汇总而来的。这在出现收货差异时（例如，系统建议收15件，但单据上是10件+5件），使得核对工作变得困难，降低了系统的可用性和可信度。这构成了一个 **UI 死胡同 (UI Dead End)**，即用户看到了一个可点击的元素，但无法通过它完成预期的任务。
*   **涉及文件**:
    *   `dc_html/mrs/js/backend.js` (前端功能未实现)

### 3.3 已验证的健壮流程

本次审计同样确认了以下流程不存在明显的操作性问题：

*   **出库流程**: “新建出库单” -> “添加/编辑明细” -> “保存草稿” -> “确认出库”整个流程前后端数据链路通畅，后端对状态和数据的处理逻辑正确。
*   **批次/SKU/品类管理**: 所有 CRUD (创建、读取、更新、删除) 操作均能正确触发对应的后端 API，且后端 API 包含了防止非法删除（如删除已确认批次）的保护逻辑。
*   **库存盘点与极速出库**: 功能可以被正确触发，前后端数据交互正常。

## 4. 结论与建议
MRS 系统的应用层稳定性总体良好，但存在一个**严重的功能中断 Bug**，必须作为最高优先级进行修复，以恢复核心入库流程的可用性。

**首要建议**:
1.  **修复合并确认功能**: 修改 `backend.js` 中的 `showMergePage` 函数，在获取合并数据后，将 `result.data.items` 正确赋值给 `appState.mergeItems`。

**次要建议**:
1.  **实现“查看明细”功能**: 为 `viewRawRecords` 函数添加实现，允许用户查看构成合并项的原始收货记录。

解决以上两个问题将极大提升系统的稳定性和用户体验。
